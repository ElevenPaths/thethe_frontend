<template>
  <v-container>
    <v-layout v-if="status === 2">
      <v-flex class="font-weight-bold">This hash is not in Malware Bazaar</v-flex>
    </v-layout>
    <v-layout v-else-if="status === 1">
      <v-expansion-panel accordion>
        <v-expansion-panel-content>
          <template v-slot:header>
            <span class="title">Database Entry</span>
          </template>
          <v-flex class="scrollable">
            <v-layout column>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">SHA256:</v-flex>
                <v-flex>{{ resource.data[0].sha256_hash }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">SHA3-384:</v-flex>
                <v-flex>{{ resource.data[0].sha3_384_hash }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">SHA1:</v-flex>
                <v-flex>{{ resource.data[0].sha1_hash }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">MD5:</v-flex>
                <v-flex>{{ resource.data[0].md5_hash }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">File name:</v-flex>
                <v-flex>{{ resource.data[0].file_name }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Download:</v-flex>
                <v-flex>
                  <a
                    target="_blank"
                    rel="noopener noreferer"
                    :href="'https://bazaar.abuse.ch/download/'+ resource.data[0].sha256_hash +'/'"
                  >download sample</a>
                </v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Signature:</v-flex>
                <v-flex>{{ resource.data[0].signature }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">File size:</v-flex>
                <v-flex>{{ resource.data[0].file_size }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">First seen:</v-flex>
                <v-flex>{{ resource.data[0].first_seen }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Last seen:</v-flex>
                <v-flex>{{ resource.data[0].last_seen }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">File type:</v-flex>
                <v-flex>{{ resource.data[0].file_type }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">MIME type:</v-flex>
                <v-flex>{{ resource.data[0].file_type_mime }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">imphash:</v-flex>
                <v-flex>
                  <a
                    target="_blank"
                    rel="noopener noreferer"
                    :href="'https://bazaar.abuse.ch/browse.php?search=' + resource.data[0].imphash"
                  >{{ resource.data[0].imphash }}</a>
                </v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">ssdeep:</v-flex>
                <v-flex>{{ resource.data[0].ssdeep }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">TLSH:</v-flex>
                <v-flex>
                  <a
                    target="_blank"
                    rel="noopener noreferer"
                    :href="'https://bazaar.abuse.ch/browse.php?search=' + resource.data[0].tlsh"
                  >{{ resource.data[0].tlsh }}</a>
                </v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Reporter:</v-flex>
                <v-flex>@{{ resource.data[0].reporter }}</v-flex>
              </v-layout>
              <v-layout v-if="resource.data[0].comment">
                <v-flex lg2 class="font-weight-bold subtitle-1">Comment:</v-flex>
                <v-flex>@{{ resource.data[0].comment }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Tags:</v-flex>
                <v-flex>
                  <span v-for="(tag_sign, index) in resource.data[0].tags  " :key="index">
                    {{ tag_sign }}
                    <br />
                  </span>
                </v-flex>
              </v-layout>
            </v-layout>
          </v-flex>
        </v-expansion-panel-content>

        <v-expansion-panel-content v-if="resource.data[0].intelligence">
          <template v-slot:header>
            <span class="title">Intelligence</span>
          </template>
          <v-flex class="scrollable">
            <v-layout column>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1"># of Uploads:</v-flex>
                <v-flex>{{ resource.data[0].intelligence.downloads }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1"># of Downloads:</v-flex>
                <v-flex>{{ resource.data[0].intelligence.uploads }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">ClamAV:</v-flex>
                <v-flex>
                  <span
                    v-for="(clamav_sign, index) in resource.data[0].intelligence.clamav"
                    :key="index"
                  >
                    {{ clamav_sign }}
                    <br />
                  </span>
                </v-flex>
              </v-layout>
            </v-layout>
          </v-flex>
        </v-expansion-panel-content>

        <v-expansion-panel-content v-if="resource.data[0].yara_rules">
          <template v-slot:header>
            <span class="title">Yara Signatures</span>
          </template>
          <v-flex class="scrollable">
            <v-layout column v-for="(yara, index) in resource.data[0].yara_rules" :key="index">
              <v-layout class="rule_shadow">
                <v-flex lg2 class="font-weight-bold subtitle-1">Rule name:</v-flex>
                <v-flex>{{ yara.rule_name }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Author:</v-flex>
                <v-flex>{{ yara.author }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Description:</v-flex>
                <v-flex>{{ yara.description }}</v-flex>
              </v-layout>
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">Reference :</v-flex>
                <v-flex>{{ yara.reference }}</v-flex>
              </v-layout>
              <br />
              <br />
            </v-layout>
          </v-flex>
        </v-expansion-panel-content>

        <v-expansion-panel-content v-if="resource.data[0].file_information">
          <template v-slot:header>
            <span class="title">File Information</span>
          </template>
          <v-flex class="scrollable">
            <v-layout
              column
              v-for="(fileinfo, index) in resource.data[0].file_information"
              :key="index"
            >
              <v-layout>
                <v-flex lg2 class="font-weight-bold subtitle-1">{{ fileinfo.context }}</v-flex>
                <v-flex>{{ fileinfo.value }}</v-flex>
              </v-layout>
              <br />
            </v-layout>
          </v-flex>
        </v-expansion-panel-content>
      </v-expansion-panel>
    </v-layout>
  </v-container>
</template>
<script>
import { make_unique_list } from "../../../utils/utils";

export default {
  name: "malwarebazaar",
  props: {
    plugin_data: Object
  },
  data: function() {
    return {};
  },
  computed: {
    resource: function() {
      let plugin_result = { ...this.plugin_data.results };

      return plugin_result;
    },
    status: function() {
      return this.plugin_data.result_status[0];
    }
  }
};
</script>

<style scoped>
.scrollable {
  margin-top: 1.4rem;
  margin-bottom: 1.4rem;
  margin-left: 3rem;
  max-height: 30rem;
  overflow-y: scroll;
  overflow-x: hidden;
}
body {
  width: 200px;
  margin: 0 auto;
}
.rule_shadow {
  color: #4caf50;
}
::-webkit-scrollbar {
  width: 12px;
}

::-webkit-scrollbar-track {
  -webkit-box-shadow: inset 0 0 6px rgba(201, 201, 201, 1);
  box-shadow: inset 0 0 6px rgba(201, 201, 201, 1);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  border-radius: 10px;
  -webkit-box-shadow: inset 0 0 6px rgba(201, 201, 201, 1);
  box-shadow: inset 0 0 6px rgba(201, 201, 201, 1);
}
.v-expansion-panel__container {
  box-shadow: inset 0 0 6px rgba(201, 201, 201, 1);
  border-radius: 5px;
  margin-bottom: 0.5rem;
}
a {
  text-decoration: none;
  color: #fff;
}
a:hover {
  font-weight: bold;
}
.v-btn {
  min-width: 0;
  margin: 0;
  padding: 0;
}
</style>
